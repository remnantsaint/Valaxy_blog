---
layout: post
title: 深度学习之旅
date: 2025-03-03 13:18:03
updated: 2025-09-15 
time_warning: true
cover: 
top: 
tags: 
- 深度学习
categories: 
 - 深度学习
# author: @Remsait
---
## 环境准备
  首先要在jupyter上能进行`import pytorch`，实验室电脑不支持CUDA，所以下CPU版的pytorch  
```bash
#先创建环境
  conda create -n pytorch python=3.6 -y
  activate pytorch
#安装CPU版pytorch
  conda install pytorch torchvision cpuonly -c pytorch
#安装 Jupyter 并让 mytorch 在 Jupyter Notebook 中可用
  conda install jupyter -y
#重新启动jupyter并选择已存在内核
```
  注意不要既用`conda`来安装包，又用`pip`安装包，会导致依赖发生问题  

  在 Anaconda prompt 中输入 `jupyter notebook D:` 就能打开了  
  用 jupyter 前先在Anaconda中切换到pytorch环境，再打开 jupyter 换内核
```python
import sys
import torch
# 查看Python版本
print(f"Python版本: {sys.version}")
# 查看PyTorch版本
print(f"PyTorch版本: {torch.__version__}")
# 查看当前Python解释器路径（确认是否为目标环境）
print(f"Python解释器路径: {sys.executable}")
```
## 基本知识
  `dir()`函数能让我们知道工具箱，以及工具箱中都有什么东西，比如 dir(torch)  
  `help()`函数能让我们知道每个工具的使用方法,比如 help(torch.cuda.is_available)  
  
  运行 python 代码的三种方式：python文件、pycharm python console、jupyter notebook  
  
## PyTorch 加载数据
  两个类：Dataset , Dataloader  
  
  Dataset 提供一种方式去获取数据及其 label  
  Dataloader 为后面网络提供不同的数据形式  
`read_data.py`代码如下：
```python
from torch.utils.data import Dataset
from PIL import Image
import os

class MyData(Dataset):
    def __init__(self, root_dir, label_dir): # 初始化定义一些变量
        # root_dir = "dataset/train"  label_dir = "ants"
        # 这样组合是为了更好的分开蚂蚁和蜜蜂，也就是标签
        self.root_dir = root_dir
        self.label_dir = label_dir
        self.path = os.path.join(self.root_dir, self.label_dir)
        self.img_path = os.listdir(self.path) # 从文件夹内容获取列表 img_path

    # __开头和结尾的都是魔法方法，不用调用，在初始化时会自动调用
    def __getitem__(self, idx):
        img_name = self.img_path[idx]
        img_item_path = os.path.join(self.root_dir, self.label_dir, img_name) # 图像的文件路径
        img= Image.open(img_item_path) # 打开图像
        label= self.label_dir
        return img, label  # 返回单个图像和其标签

    def __len__(self):
        return len(self.img_path) # len(列表) 返回列表的长度

root_dir = "data/hymenoptera_data/train"
ants_label_dir = "ants"
bees_label_dir = "bees"
ants_dataset = MyData(root_dir, ants_label_dir) # 创建一个蚂蚁数据集
bees_dataset = MyData(root_dir, bees_label_dir) # 创建一个蜜蜂数据集
'''
ants_dataset[0][0].show() # 第一个0是索引，指第一个文件；第二个0是自动返回的img，
print(ants_dataset[0][1]) # [0][1]就是label
'''
img, label = ants_dataset[0]
img.show()

train_dataset = ants_dataset + bees_dataset 
# 只有定义了__len__方法，才能相加
# 顺序是前后两个数据集的拼接
print(len(train_dataset))
```
  
## TensorBoard 的使用
### TensorBoard 安装
  `conda install tensorboard -y`
### 使用
  首先安装 opencv ：`conda install -c conda-forge opencv -y`  
  
  PIL提取的文件类型不符合`add_image()`函数的要求，但是 opencv 符合（可以用 numpy 把 PIL 提取的转变为 array  
  
`test_tb.py`代码如下：  
```python
from torch.utils.tensorboard import SummaryWriter
import numpy as np
from PIL import Image
import os

writer = SummaryWriter("logs") # 创建日志文件夹
# 在终端用 tensorboard --logdir=logs --port=6007 运行查看

image_path = os.path.join("data", "train", "ants_image", "0013035.jpg")
img_PIL = Image.open(image_path)
img_array = np.array(img_PIL)
writer.add_image("test", img_array, 1, dataformats='HWC') # 添加图像
# 用 HWC 是因为 array 的 shape 中通道是最后一个参数
# 如果换张图片再运行，网页就能看到 step2 是第二张图片了

for i in range(100):
    writer.add_scalar("y=3x", 3*i, i) # 第一个参数是标签，第二个参数是 y，第三个参数是 x

# 左上角切换 scalars 和 images

writer.close()

# 观察训练时候，给 model 用了哪些数据，或者对 model 测试时看每一阶段的输出结果
```

## torchvision 中的 transforms
  trasforms 主要是对图片进行一些变换
### 结构及用法
## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4
## 1
## 2
## 4
  

  
