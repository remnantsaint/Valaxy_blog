---
layout: post
title: ProS-GNN 文献精读
date: 2025-09-29 10:56:26
updated: 2025-09-29
time_warning: true 
cover: 
top: 
tags: 
 - ddg
categories: 
 - 生物信息
# author: @Remsait
---
# ProS-GNN：使用图神经网络预测突变对蛋白质稳定性的影响
[ProS-GNN: Predicting effects of mutations on protein stability using graph neural networks](https://doi.org/10.1016/j.compbiolchem.2023.107952)  
## 摘要
  通过计算方法预测蛋白质变异后的稳定性变化，是揭示突变导致药物失效机制和开发免疫治疗策略的有力工具。一些先前基于机器学习的技术对稳定性降低的情况表现出反向对称性偏差，而另一些方法则难以对未见过的样本进行泛化。

  为解决这些问题，我们提出了一种基于门控图神经网络的方法来预测蛋白质突变后的稳定性变化。该模型通过消息传递来编码分子结构与性质之间的关联，其过程包括剔除非突变结构并创建输入特征向量。在此过程中，模型还整合了原始原子的坐标，以提供对化学系统的空间洞察。我们在Ssym、肌红蛋白（Myoglobin）、Broom和p53数据集上测试了该模型，以验证其泛化性能。与现有方法相比，我们提出的方法在更短的时间内实现了更高的线性度和对称性。[代码](https://github.com/HongzhouTang/Pros-GNN)  
## 引言
  由于变异导致的氨基酸改变可能会引起蛋白质稳定性的变化。推断突变引起的蛋白质稳定性变化的一种方法是测量 ΔΔG，即突变体与野生型之间折叠自由能的变化。ΔΔG 的负值表示该变异会降低蛋白质的稳定性，而正值则表示稳定性增加。研究表明，蛋白质稳定性的变化是多种突变相关疾病的主要分子机制之一。深入理解特定突变如何影响蛋白质的稳定性或相互作用，有助于识别患者可能产生的药物耐药性，从而为癌症等疾病开发潜在的新型精准药物提供可能。

  癌症。鉴于预测突变后蛋白质稳定性变化的巨大潜力，研究人员开发了多种计算工具，因为这些工具成本低且通量高。早期预测蛋白质稳定性的尝试主要基于分子动力学模拟。这些方法利用统计物理学原理，从蛋白质结构中估算自由能函数，或基于分子力学，利用生物物理特征的知识性参数进行回归拟合。这些方法在刻画折叠诱导的自由能变化的物理本质方面显示出优势。

  基于机器学习（ML）的数据驱动方法在预测突变引起的蛋白质稳定性变化方面也展现出巨大前景。这些方法因其计算高效且性能优异而备受关注。支持向量机（SVM）、决策树、随机森林（RF）、梯度提升、神经网络以及上述方法的组合等算法均已被应用，并展现出良好的性能。在将数据输入机器学习流程之前，这些方法通常需要进行特征提取。一些研究仅需基于序列的数据，而另一些则可能需要基于结构的数据。通常，使用三维结构的方法优于基于序列的方法。然而，许多先前的研究容易在变异的一个方向上产生偏差，并且存在过拟合问题，限制了其实际应用。因此，问题的关键在于如何充分挖掘有限的实验数据，并捕捉到具有信息量的特征。

  端到端的深度学习似乎是一种很有前景的解决方案，能够实现对各种符号化数据的表征学习。这类方法在训练过程中直接利用训练数据集来学习输入特征，无需进行人工特征工程。因此，已有研究采用基于三维卷积神经网络的方法，在预测蛋白质稳定性变化方面取得了高性能。该方法将蛋白质结构视为三维图像进行处理，通过体素化（voxelization）参数化，并以原子的生物物理特性作为输入。然而，三维网格表示会包含大量没有原子存在的空洞空间，导致计算效率低下。

  从多体系统的角度来看，分子（如蛋白质）本质上是图结构，其中顶点代表原子，边代表化学键。总自由能是所有原子能量贡献的总和。图神经网络（GNN）为直接从结构数据中揭示结构与性质之间的关系提供了新的可行方案。由于参数较少，GNN在保持较高精度的同时具有相对较低的计算成本。此外，通过分析相邻原子之间的相互关系，GNN能够识别决定分子性质的关键原子特征。换句话说，消息传递过程能够提取结构特征，并将其与目标性质相关联。已有研究从量子化学的角度展示了类似方法在原子能量预测中的应用，这表明GNN在蛋白质相关能量变化预测方面具有巨大潜力。然而，据作者所知，目前利用GNN进行蛋白质稳定性变化预测的研究仍然十分有限

  在此，我们提出一种利用深度学习模型预测突变后蛋白质稳定性变化的新方法。在去除蛋白质中非突变部分之后，该模型将蛋白质的结构信息和元素组成映射为高维表示，并通过门控图神经网络（gated GNN）自动捕捉关键影响因素。我们的核心概念创新在于，将该方法的实现建立在遵循基本生物化学规律的基础之上。我们通过在S2648数据集上进行训练来展示该方法的高性能，随后在Broom、Ssym、肌红蛋白（Myoglobin）和p53数据集上对训练好的模型进行测试。最后，我们证明所采用的数据修剪策略显著提升了训练和测试速度，满足了制药行业对高通量分析的需求。
## 方法
### 2.1 问题表述和输入特征
  我们的任务是预测突变蛋白与野生型蛋白之间的吉布斯自由能变化（ΔΔG）。我们的设计理念源于多体系统概念，在遵循生物化学基本原理的同时，保持了数据驱动方法的灵活性。图1(A)展示了该方法的整体架构。模型的详细说明见第2.2节。
<img src="https://cloudflare.remsait.com/img/pros-gnn202509291203571.png"  alt="404" title=""  />
<center><div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">
      (A) ProS-GNN 的整体架构。该过程包含五个步骤：(1) 提取突变残基及其邻近残基；(2) 随后构建用于输入的分子信息矩阵和邻接矩阵；(3) 数据经过图神经网络（GNN）处理，并融入原子坐标信息；(4) 将突变型的特征向量减去野生型的特征向量；(5) 将得到的差异特征向量输入多层感知机（MLP）以预测 ΔΔG。
  	</div>
</center>
  输入特征从PDB文件中提取，这些文件包含了蛋白质的组成和结构信息。我们为第 i 个原子构建了长度为 30 的蛋白质特征向量 $h_i$。该特征向量编码了原子类型、相邻原子数量、相邻氢原子数量、隐式化合价以及芳香键等信息。（果然还得是原子图吗

  随后，将这些特征向量组合起来，形成蛋白质的输入特征矩阵 $H = [h_1, ..., h_{n+r}]$，其中 $H \in R^{(n+r)×30}$。n 和 r 分别表示突变部分和非突变部分的原子数量。输入数据编码方式及特征向量的详细说明如图1(B)所示。
<img src="https://cloudflare.remsait.com/img/pros-gnn202509291209111.png"  alt="404" title=""  />
<center><div style="color:orange; border-bottom: 1px solid #d9d9d9;
    display: inline-block;
    color: #999;
    padding: 2px;">
      (B) 门控GNN中数据输入与消息传递过程的示意图。第i个原子向量包含原子类型、相邻氢原子数、化合价和芳香键等初始原子特征。邻接矩阵表示原子之间的连接关系。
  	</div>
</center>

  野生型和突变型的特征矩阵分别表示为 $H^w \in R^{n×30}$ 和 $H^m \in R^{n×30}$ 。同样地，野生型和突变型原子的坐标矩阵分别为 $D^w \in R^{n×3}$ 和 $D^m \in R^{n×3}$。邻接矩阵 $A^w \in R^{n×n}$ 和 $A^m \in R^{n×n}$ 表示蛋白质中各原子间的相邻关系。这些矩阵共同构成了预测目标 y ，即 ΔΔG 的输入特征。因此，整体问题可以描述为利用上述特征矩阵和坐标矩阵来预测突变前后的吉布斯自由能变化（ΔΔG）。具体来说，该过程涉及对野生型和突变型的数据进行编码，并通过门控图神经网络（gated GNN）处理这些信息以提取结构特征，最终通过对比突变型与野生型的特征向量差异并将其输入多层感知机（MLP）来完成ΔΔG的预测：
$$y = MLP(GNN(H^w, A^w, H^w, A^m),D^w, D^m)$$ 

  其中，MLP 是多层感知机（Multi-Layer Perceptron）的缩写。与处理完整的蛋白质特征矩阵 H 不同，我们的模型仅处理突变残基及其相邻两个残基的信息，记为 $H \in R^{n×30}$，其余部分 $H_r \in R^{r×30}$ 则通过一个自动化脚本被剔除（裁剪）。 
### 2.2 深度学习模型
  我们使用一个权重矩阵 $W_e \in R^{30×1140}$ 扩展了第一层特征向量的维度，从而得到 $H_e^{(1)} = H_eW_e$，其中 $H_e^{(1)} \in R^{n×1140}$。维度参数是通过优化获得的，更多细节在 3.2 节。在图神经网络中，第 l 层的源自特征 $H_e^{(l)}$ 通过图卷积迭代处理，产生一组更新后的原子特征：
$$H_e^{(l + 1)} = LeakyRelu(WAH_e^{(l)})$$
  其中，$W \in R^{n×n}$ 是一个科学系的权重矩阵，LeakyRelu 是激活函数。

  这是一个简化的消息传递过程，其中每个原子从其相邻的原子和化学键中收集局部信息，然后更新自身的信息。通过原子之间的信息共享，该方法能够提取出全局特征。通过这种方式，图神经网络（GNN）从分子结构中隐式地学习到了其性质。

  为了增强网络的长期记忆能力，我们将门控机制引入网络中。门控图层是对 $H_e^{(l)}$ 和 $H_e^{(l+1)} \in R^{n×1140}$ 的线性组合：
$$H_e^{gate} = GH_e^{(l)} + (1-G)H_e^{(l+1)}$$
$$G = f(W_{gate}[H_e^{(l)} H_e^{(l+1)}] + B)$$
  其中，$W_{gate} \in R^{n×1140}$ 是一个科学系的权重矩阵，$B \in R^{n×1140}$ 是一个偏置矩阵，f 是 Sigmoid 非线性激活函数。经过门控连接得到的特征矩阵 $H_e^{gate} \in R^{n×1140}$ 随后被添加到第一层的特征矩阵 $H_e^{(l)}$ 上：
$$H_e^{gnn} = H_e^{(l)} + H_e^{gate}$$
  其中，$H_e^{gnn} \in R^{n×1140}$ 是图神经网络的最终输出。

  然后，我们将 $H_e^{gnn}$ 与坐标矩阵 $D \in R^{n×3}$ 进行拼接，生成一个新的特征矩阵：$H_e^{d} = [H_e^{gnn}D] = [h_1^{d},...., h_n^{d}] \in R^{n×1143}$，其中 $h_i^{d} \in R^{1143}$ 表示第 i 个原子的扩展特征向量。我们假设 $h_i^{d}$ 编码了该原子对分子能量的贡献，因此所有原子贡献的总和即对应于分子的总能量：
$$z_{out} = \sum_{1}^{n} h_i^{d}$$
  这一步将经过GNN提取并融合空间坐标的原子级特征进行汇总，用于后续预测整个分子系统的能量变化（ΔΔG），体现了从原子局部特征到全局性质的映射过程。

  最后，将突变型的特征向量减去野生型的特征向量，得到差异化的特征向量。该特征向量经过多层感知机（MLP）处理后用于预测 ΔΔG。上述过程可表示为：
$$y = MLP(LeakyRelu(W_{out}(z_{out}^{m} - z_{out}^{w}) + b_{out}))$$
  其中 $W_{out} \in R^{1024×1024}$ 是权重矩阵，$b_{out} \in R^{1024}$ 是偏置向量。

  给定训练集中所有 ΔΔG 的标签，训练目标是最小化均方误差（MSE）损失函数：
$$\ell=\frac{1}{N} \sum_{i-1}^{N}\left(y_{i}-\widehat{y}_{i}\right)^{2}$$
  其中 $y_i$ 表示第 i 个样本的预测 ΔΔG 值；$\widehat{y}_{i}$ 表示第 i 个样本的实验测得的 ΔΔG 值；N 为样本总数。
## 实验
### 3.1 数据集
  S2648 是 ProS-GNN 的训练数据集，包含 131 种不同球状蛋白中的 2648 个单点突变。该数据集源自 ProTherm 数据库，由 Dehouck 等人（2009）整理而成，已被 PoPMuSiC、mCSM、DUET、INPS3D 等多种方法用作训练数据集。其中包含 568 个稳定化突变和 2080 个去稳定化突变。

  Ssym 是由 Pucci 等人（2018）手动整理的数据集，包含 684 个变异，其中一半为反向变异，并提供了相应突变蛋白的晶体结构。该数据集中有 81 个稳定化突变和 261 个去稳定化突变。

  Myoglobin（肌红蛋白）数据集包含细胞质球状蛋白，这类蛋白参与调控细胞内的氧气浓度（Ordway 和 Garry，2004）。该数据集包含 36 个稳定化突变和 98 个去稳定化突变。

  Broom 数据集由 Broom 等人（2017）手动整理，共包含 605 个变异，其中有 147 个稳定化突变和 458 个去稳定化突变。

  p53 数据集由 Pires 等人作为案例研究引入（Pires 等，2014b），包含肿瘤抑制蛋白 p53 的 DNA 结合结构域内的 42 个变异，其中有 11 个稳定化突变和 31 个去稳定化突变。
### 3.2 模型实现与评估
  本研究中的网络设计涉及多个架构选择，例如 GNN 层数、全连接（FC）层数、特征维度大小以及 Dropout 率等。考虑到本研究中训练数据集规模有限，我们采用交叉验证（cross-validation）来确定最优的网络架构。具体而言，我们使用网格搜索（grid-search）技术对各项超参数进行系统性调优。

  由于仅在蛋白质层面进行分组无法充分消除序列同源性带来的偏差（即同一蛋白的多个突变可能造成数据泄露），我们采取了更为严格的划分策略：在突变层面将整个数据集随机均分为十个大小相等的子集，以确保训练集和测试集之间不存在来自同一蛋白的相似突变，从而保证评估结果的可靠性和泛化能力。（不按蛋白质分组，直接随机分配到十个子集

  我们的十折交叉验证结果表明，顶点向量（即原子特征向量）的维度应设为1120，全连接（FC）层的维度为1024。GNN部分和全连接部分均包含四层。当权重衰减（weight decay）设置为5×10⁻⁵时，模型表现出更优的性能。Dropout率为0.5，批处理大小（batch size）为16。我们使用PyTorch实现了该模型，并采用Adam优化器进行优化。最后，本研究使用Nvidia GeForce GTX 3070 GPU进行计算。

  本研究使用了Nvidia GeForce GTX 3070 GPU进行计算。为评估ProS-GNN的性能，采用了以下评价指标：主要的预测准确性评估指标包括实验值与预测值之间的皮尔逊相关系数（r）、平均绝对误差（MAE）以及均方根误差（RMSE, σ）。较低的RMSE和MAE表明模型的预测结果与实际值更为接近。同时，使用 $r_{dir-rev}$ 和 $δ_{dir-rev}$ 来评估直接突变与反向突变之间预测结果的偏差。这些指标的具体定义可参考Li等人（2020年）和Pucci等人（2018年）的研究。 

## 复现
```bash
conda create -n ddg python=3.8
conda activate ddg
pip install rdkit numpy sklearn
pip install torch torchvision --index-url https://download.pytorch.org/whl/cu121
```
  代码通过 train/keys/ 目录下的键值对来确认训练和测试用的突变

  我复现的时候 rdkit 会报一些蛋白质 pdb 文件的错误，一共五个，在训练和键值对剔除这五个键值对后正常训练

  一共运行400 epoch ，最后得到的模型
```
  model = torch.load('model1217.pkl')    # move the trained model to the predict folder
predict.py:50: RuntimeWarning: divide by zero encountered in divide
  acc = pred/labels
test_corrcoef 0.6117286194554096 rmse 1.2313640625865698
```
  结果和文献对的上，在 ssym 数据集测试的 PCC 值约等于 0.61

---

  重新看了一下，这个文献给的代码，训练集和训练时的验证集还有测试集存在严重的数据泄露！！！
  
  按原来数据训练，训练过程中的测试pcc达到了0.6，用这个模型来预测把同样突变删去的测试集，pcc为4.6
  
  原来数据集按突变分而不是蛋白质分，按蛋白质分后，训练过程中的测试pcc最高只有0.4，且有过拟合

  